name: 'Build and push to S3'

# **What it does**: Converts README to docx and pushes to S3.
# **Why we have it**: Recruiters want files and not links to Github.
# **Who does it impact**: My career.

on: [push]

permissions:
  contents: read

jobs:
  convert:
    runs-on: pandoc/latex:2.6
    steps:

      - name: Checkout
        uses: actions/checkout@v3

      - name: Convert docs
        run: ./pandoc.sh

      - name: Upload output files
        uses: actions/upload-artifact@v3
        with:
          name: converted-files
          path: |
            SimonStaszkiewiczResume.docx
            SimonStaszkiewiczResume.html
            SimonStaszkiewiczResume.zip
  push:
    runs-on: ubuntu-latest
    needs: convert
    steps:

      - name: Download output files
        uses: actions/download-artifact@v3
        with:
          name: converted-files

      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup node
        uses: actions/setup-node@v3
        with:
          node-version: 18.x
          cache: npm

      - name: Install
        run: npm ci

      - name: Push files to s3
        run: ./push.sh
